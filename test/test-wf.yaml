apiVersion: argoproj.io/v1alpha1
kind: WorkflowTemplate
metadata:
  name: test-runner
  namespace: test
spec:
  entrypoint: main
  podGC:
    strategy: OnWorkflowSuccess
  serviceAccountName: operate-workflow-sa
  templates:
  - name: main
    steps:
    - - continueOn:
          error: true
          failed: true
        name: runTest
        template: run-test
  - container:
      name: runner
      image: argoproj/argosay:v1
      args:
      - cowsay qwe && exit 1
      command:
      - sh
      - -c
    metrics:
      prometheus:
      - counter:
          value: "1"
        help: Count of runs by exit code
        labels:
        - key: exit_code
          value: '{{lastRetry.exitCode}}'
        name: runs_exit_status_counter
    name: run-test
    retryStrategy:
      limit: "5"
      retryPolicy: OnTransientError
